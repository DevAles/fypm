#!/bin/zsh
ONLY_ALARM=false
usage() {
    echo "Usage: $0 [OPTION] [...args]"
    echo "      normal_args: <id> <worktime> [alarm_time]"
    echo "Options:"
    echo "  -a  Specify only an alarm time."
    echo "      args: <id> <alarm_time>"
}
verify_args() {
    if [[ "$1" == "-a" ]]; then
        shift

        if [[ $# -eq 2 ]]; then
            ID="$1"
            ALARM="$2"
            ONLY_ALARM=true

            return 0
        else
            echo "With -a option, you can only specify two arguments!"
            usage
            return 1
        fi
    fi

    if [[ $# -lt 2 ]]; then
        echo "Too few arguments!"
        usage
        return 1
    elif [[ $# -gt 3 ]]; then
        echo "Too many arguments!"
        usage
        return 1
    else
        if [[ -n "$3" ]]; then
            ALARM="$3"
        fi

        ID="$1"
        WT="$2"
    fi
}
apply_alarm() {
    task "$ID" modify ALARM:"$ALARM"

    echo "\nThe task with id '$ID' was scheduled to be warned at '$ALARM'!"
}
main() {
    if [[ $ONLY_ALARM == true ]]; then
        apply_alarm
    else
        if [[ -n $ALARM ]]; then
            apply_alarm
        fi

        task "$ID" modify WT:"$WT"
    fi
}

verify_args "$@" || exit 1
main
